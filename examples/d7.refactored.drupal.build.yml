#
# Example build configuration for a vanilla Drupal 7 site.
#
# Planned refactor for using Symfony's Config component.
#
# @see https://github.com/pfaocle/d7-drupal-runner-example/blob/master/README.md
#

#
# Configuration for this build.
#

# Build details - Git, remotes, Drush, make file etc.
build:
    git: "https://github.com/pfaocle/d7-drupal-runner-example.git"
    drush_alias: "@d7.local"
    profile: minimal
    sites_subdir: d7
    make: d7.make
    make_path: sites/d7
    sites:
        - 8080.d7.drupal.dev
        - d7.stage.example.com
        - d7.prod.example.com

    # Site details - name and root user credentials.
    site:
        site_name: Drupal 7
        root_username: root
        root_password: root
        theme: bootstrap_d7

    # Database details.
    database:
        db_name: d7
        db_username: root
        db_password: root

    # Pre-steps.
    pre:
        modules:
            - features
        commands:
            - vset site_mail "noreply@example.com"

    # Enable features.
    features:
        - dr7_example_feature

    # Migration.
    migrate:
        # Note we assume that Migrate and Migrate UI are required.
        dependencies:
            - migrate_d2d
            - migrate_extras
            - migrate_mysite                                            # Your custom migration module/classes.
        source:
            files:
                variable: mysite_file_migration                         # File migrations can use this to set source files path.
                dir: /var/www/vhosts/mysite-old.drupal.dev/files        # Provide the path to the source files folder.
        groups:                                                         # We can migrate groups, in order...
            - users
            - terms
            - default
        migrations:                                                     # ... and/or also run individual migrations, in order.
            - Roles
            - Users

    # Post-steps.
    post:
        commands:
            - sqlq "UPDATE block SET status = 1, region = 'sidebar_first' WHERE module = 'user'"
